# Caddyfile - Caddy 리버스 프록시 설정
#
# 사용 방법:
# 1. 로컬 테스트: caddy run (자동으로 localhost HTTPS 인증서 생성)
# 2. 프로덕션: 아래 도메인 주소를 실제 도메인으로 변경 후 caddy run

# # ============================================================
# # 로컬 개발/테스트 모드 (기본값)
# # ============================================================
# localhost, :80, :443 {
#     # 정적 파일 서빙 (빌드된 React 앱)
#     root * app/static/dist

#     # SPA 라우팅 지원 (React Router 등)
#     try_files {path} /index.html

#     # API 요청은 Flask로 프록시
#     handle /api/* {
#         reverse_proxy localhost:5050
#     }

#     # Swagger 문서
#     handle /docs* {
#         reverse_proxy localhost:5050
#     }

#     handle /apidocs/* {
#         reverse_proxy localhost:5050
#     }

#     handle /apispec.json {
#         reverse_proxy localhost:5050
#     }

#     # 정적 파일 서빙
#     file_server

#     # 로깅
#     log {
#         output file /var/log/caddy/access.log
#         format json
#     }
# }

# ============================================================
# 프로덕션 모드 (실제 도메인 사용 시)
# ============================================================
# 사용하려면 아래 주석을 해제하고 your-domain.com을 실제 도메인으로 변경하세요
# 그리고 위의 localhost 블록은 주석 처리하세요

embedded.sjparklab.com {
    # 자동 HTTPS (Let's Encrypt)
    # Caddy가 자동으로 인증서를 발급하고 갱신합니다

    # 정적 파일 서빙 (빌드된 React 앱)
    root * app/static/dist

    # SPA 라우팅 지원
    try_files {path} /index.html

    # API 요청은 Flask로 프록시
    handle /api/* {
        reverse_proxy localhost:5050
    }

    # Swagger 문서
    handle /docs* {
        reverse_proxy localhost:5050
    }

    handle /apidocs/* {
        reverse_proxy localhost:5050
    }

    handle /apispec.json {
        reverse_proxy localhost:5050
    }

    # 정적 파일 서빙
    file_server

    # 로깅
    log {
        output file /var/log/caddy/access.log
        format json
    }

    # 보안 헤더
    header {
        # XSS 보호
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        # HSTS (HTTPS 강제)
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }
}
